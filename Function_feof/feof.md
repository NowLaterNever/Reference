# 一、feof()是什么？

> feof()是检测流上的文件结束符的函数，如果文件结束，则返回非0值，否则返回0.

一般在文件操作，中经常使用feof()判断文件是否结束。


# 二、feof()的经典错误

根据这个函数的定义，一般大家都是这样使用的，但是这样使用，文件中无论是否有内容，都会被判断为“文件不为空”。

```c
#include<stdio.h>
int main(void)
{
    FILE *p = NULL;
    
    p = fopen("open.txt", "r");
    if (feof(p)) {
    	printf("文件为空。");
    } else {
    	printf("文件不为空。");
    }
    
    return 0;
 }
```

# 三、feof()的原理

## 1. EOF

> EOF是一个计算机术语，为End Of File的缩写，在操作系统中表示资料源无更多的资料可读取。资料源通常称为档案或串流。通常在文本的最后存在此字符表示资料结束。

这个定义的意思是，文档的结尾都有一个隐藏字符”EOF”，当程序读取它的时候，就会知道文件已经到达结尾。通常使用**while循环加EOF判断**作为读取结束的标志。

> EOF 的值通常为 -1，但它依系统有所不同。

## 2. feof

- feof()的原理
  - feof()函数，并不是通过读取到文件的EOF来评判，这个文件是否为空。
  - 对feof()来说,它的工作原理是，站在光标所在位置，向后看看还有没有字符。如果有，返回0；如果没有，返回非0。它并不会读取相关信息，只是查看光标后是否还有内容。
- 直接使用时的错误分析：
  - 对于一个空文件来说，当程序打开它的时候，它的光标会停在文件的开头，但是由于文件里什么内容都没有存（但是EOF是存在的），即整个文件就存贮了一个EOF。当程序打开文件，并直接调用feof()时，这个函数就会站在光标的位置向后张望，结果就看见了EOF，然后就当然返回0了。

# 四、如何正确使用

既然我们明白了原理，那么如何正确的使用它呢？

```c
#include<stdio.h>
int main(void)
{
    FILE *p = NULL;
    
    p = fopen("open.txt", "r");
    getc(p);
    if (feof(p)) {
        printf("文件为空。");
    } else {
        rewind(p);//将光标跳回到文件开头
        int a;
        fscanf(p,"%d",&a);
        printf("%d", a);
    }
    
    return 0;
 }
```

**分析**：

- 对于文件来说，无论是空文件，还是存有信息的文件，当文件被打开，光标处于默认的开头时，光标后都有信息，这时候调用feof()来查看光标后是否还有内容，就没意义。
- 所以我们需要从相同中找不同，先使用getc(),从文件中读取一个字符，让光标向后移动一个字符。这时空文件的光标就已经移动到EOF的后面，这时使用feof()就会返回1了。这才是feof()的正确用法。
- 但是要注意，一定要将光标回到文件的开头，因为之前判断文件是否为空时，将光标向前移动了一位，必须要将光标恢复到开头，这样才能保证文件的正常读取。





